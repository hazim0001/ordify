<!-- yielded from application html mete tag turbolink -->
<%= provide(:content,"reload") %>
<div class="container-fluid">
  <div class="row">
    <%= render 'shared/side_bar' %>

    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4" style="margin-left: 13em !important;">

      <h2 class="mt-5"><%= current_employee.restaurant.name.capitalize %>'s Orders</h2>
      <hr>
      <div class="table-responsive">
        <div class="d-flex flex-wrap">
          <% @tables.each do |table| %>
            <div class="card m-2" style="width: 45rem;">
              <div class="card-body">
                <h5 class="card-title"><%= table.name %></h5>
                <h6 class="card-subtitle mb-2 text-muted">total table till now: <%= humanized_money_with_symbol(table.orders.where(status: "not paid").sum(:total_price_cents)/ 100.0) %></h6>
                <!-- <p class="card-text">Some quick example text .</p> -->
                <% table.orders.not_paid.each do |order| %>
                <div class="accordion">
                  <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center" >
                      <h2 class="mb-1">
                        <button class="btn btn-link btn-block text-left" id="tableOrder" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" style="width: 30rem;">
                          Order #<%= order.id %>
                        </button>
                      </h2>
                      <div class="d-flex">
                        <span class="mr-3">
                          <%= humanized_money_with_symbol(order.total_price) %>
                        </span>
                        <button type="button" data-toggle="modal" data-target="#updateOrderModal<%= order.id %>" >
                          <i class="far fa-edit mx-3" style="color: gray;"></i>
                        </button>
                        <%= render partial: 'update_order_modal', locals:{ order: order } %>
                        <% if order.dispatched == false %>
                          <button type="button" data-toggle="modal" data-target="#deleteOrderModal<%= order.id %>">
                            <i class="far fa-trash-alt" style="color: gray;"></i>
                          </button>
                          <%= render partial: 'delete_order_modal', locals:{ order: order } %>
                        <% end %>
                      </div>
                    </div>
                    <!-- delete/ update order modal  -->

                    <div class="collapse trigger">
                      <div class="card-body">
                        <table class="table">
                          <thead>
                            <tr>
                              <th scope="col" style="width: 10rem;">MenuItem </th>
                              <th scope="col" style="width: 5rem;">Quantity</th>
                              <th scope="col" style="width: 10rem;">Comment/time in kitchen</th>
                              <th scope="col">status</th>
                            </tr>
                          </thead>
                          <tbody>
                            <% order.line_items.each do |line| %>
                              <% if line.ordered == false %>
                                <p class="badge rounded-pill bg-warning text-muted p-2"><%= line.menu_item.title %> has been selected by the customer but not yet sent to the kitchen</p>
                              <% else %>
                                    <tr>
                                      <td><%= line.menu_item.title%> </td>
                                      <td><%= line.quantity%></td>
                                      <% if line.dispatched_from_kitchen == true %>
                                      <td><%= (line.total_kitchen_time / 60).to_i%> mins</td>
                                      <td><span class="badge badge-success">Dispatched</span></td>
                                      <% else %>
                                      <td><%= line.comment%></td>
                                      <td><span class="badge badge-warning">Not dispatched</span></td>
                                      <td class="d-flex flex-row-reverse">
                                        <p class="card-text">
                                          <button type="button" data-toggle="modal" data-target="#updateLineModal<%= line.id %>">
                                            <i class="far fa-edit mx-3" style="color: gray;"></i>
                                          </button>
                                          <button type="button" data-toggle="modal" data-target="#deleteLineModal<%= line.id %>">
                                            <i class="far fa-trash-alt" style="color: gray;"></i>
                                          </button>
                                        </p>
                                      </td>
                                      <% end %>
                                    </tr>
                              <% end %>
                              <!-- delete / update line item -->
                              <%= render partial: 'delete_line_modal', locals:{ line: line } %>
                              <%= render partial: 'update_line_modal', locals:{ line: line } %>
                            <% end %>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </main>
  </div>
</div>
