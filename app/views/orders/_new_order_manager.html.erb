<div class="d-flex">
  <div class="col-2">
    <div class="mt-5">
      <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
        <% icons = ["fas fa-mug-hot", "fas fa-hamburger","fas fa-hotdog", "fas fa-beer", "fas fa-fish", "fas fa-wine-bottle", "fas fa-beer","fas fa-fish" ] %>
        <% counter = 0 %>
      <% @categories.each do |category| %>
        <li class="nav-item w-75" role="presentation">
          <a class="nav-link mb-3 text-center category-pill py-2" id="pills-<%= category.id %>-tab" data-toggle="pill" href="#pills-<%= category.id %>" role="tab" aria-controls="pills-home" aria-selected="true">
            <div class="d-flex align-items-center">
              <i class="<%= icons[counter] %> back-gray mr-3" ></i><span style="font-weight: bold;letter-spacing: 0.25px; color: gray;"><%= category.title.capitalize %></span>
            </div>
          </a>
        </li>
        <% counter += 1 %>
      <% end %>
      </ul>
    </div>
  </div>
  <div class="col-6">
    <div class="tab-content mt-5" id="pills-tabContent">
        <% @categories.each do |category| %>
        <div class="tab-pane fade show " id="pills-<%= category.id %>" role="tabpanel" aria-labelledby="pills-<%= category.id %>-tab">
          <div class="d-flex flex-wrap">
            <% category.menu_items.each do |menu_item| %>
            <div class="card m-2 border-0 border-r-16 shadow-menu-item" style="width: 16rem;" data-menu-item="<%= menu_item.id %>">
              <%= cl_image_tag menu_item.photos.first.key,class:"card-img-top img-menu-item-size"  %>
              <div class="card-body p-3 mt-1">
                <h5 class="text-muted"><%= menu_item.title %></h5>
                <div class="d-flex justify-content-between align-items-end mt-3">
                  <p class="mb-0 text-muted">Ordered <%= pluralize(menu_item.orders.size, "time" ) %></p>
                  <h5 class="mb-0"><%= humanized_money_with_symbol(menu_item.item_price) %></h5>
                </div>
              </div>
            </div>
            <% end %>
          </div>
        </div>
        <% end %>
    </div>
  </div>
  <div class="col-4">
    <div class="order-container mt-5 p-4 px-5" style="background-color: black; height: 55rem;position: relative;">

    <%= simple_form_for @order, url: restaurant_orders_path(@restaurant)  do |f| %>

        <div class="row mb-4" id="order-header">
          <div class="col-4 px-0">
            <h6 class="text-muted font-small">Order Number</h6>
            <p class="text-white mb-0 font-small">Order #<%= @restaurant.orders.last.id + 1 %></p>
          </div>
          <div class="col-4 px-0">
            <h6 class="text-muted font-small">Name</h6>
            <%= f.input :user_number, label: false, wrapper_html: {class:"mb-0 mr-2", style:"height: 2rem;"}, input_html: { class:"pl-2", style:"height: 2rem;padding: 0px;"}, placeholder:'User number'  %>
          </div>
          <div class="col-4 px-0">
            <h6 class="text-muted font-small">Table</h6>
            <%= f.input :table, collection: @tables, prompt: 'Select Table', label: false, wrapper_html: {class:"mb-0", style:"height: 2rem;"}, input_html: { style:"height: 2rem;padding: 0px;"} %>
          </div>
        </div>

        <div id="line-items">
          <div id="line-item-input">

          </div>
        </div>
        <div id="order-footer" class="" style="position: absolute; bottom: 0;width: 80%;">
          <div class="">
            <hr class="text-white" style="border: 1px solid white !important;">
            <div class="d-flex justify-content-between mb-3 px-5">
              <h5 class="text-white">Total</h5>
              <h5 class="text-white" id="total">0</h5>
            </div>
            <div class="d-flex justify-content-center mb-4">
              <%= f.button :submit, class: "btn btn-primary px-5 py-2" %>
            </div>
          </div>
        </div>

    <% end %>


  </div>
</div>


<style>
  .active-category-icon{
    color: rgb(28,105,244) !important;
    background-color: rgb(255,255,255) !important;
  }

  .position-absolute-bottom{
    position: fixed;

  }
  .category-pill{
    border-radius: 3rem !important;
  }

  .back-gray{
    /* background-color: white;
    color: gray; */
    color: rgb(159,160,160);
    background-color: rgb(211,210,211);
    border-radius: 50%;
    padding: 0.6rem;
  }
  .back-gray:clicked::after{
    color: rgb(28,105,244) !important;
    background-color: rgb(255,255,255) !important;
  }

  .img-menu-item-size{
    width: 254px;
    height: 169px;
    object-fit: cover;
    border-radius: 16px;
  }
  .border-r-16{
    border-radius: 16px;
  }
  .shadow-menu-item{
    box-shadow: 0 0.2rem 1rem rgba(0, 0, 0, 0.15);
  }
  .green-shadow{
    box-shadow: 0rem 0rem 3px 2px rgba(46, 204, 113, 1) !important;
  }
  .text-white{
    color: white;
  }

  .font-small{
    font-size: 14px;
  }
  .w-3{
    width: 2rem;
  }
</style>
<script>

  // const categories = document.querySelectorAll('.category-pill');
  // categories.forEach(category => {
  //   category.addEventListener('mouseover', (event) =>{
  //     // console.log(event)
  //     event.path[2].children[0].children[0].classList.add('active-category-icon')
  //     console.log()
  //     console.log(event.path[2].children[0].children[1])

  //   });
  // });






 const total = document.getElementById('total')
 // console.log(total.innerText)

  $(document).ready(function(){
    $('.card').each(function(){
      $(this).click(function(){
        $(this).toggleClass("green-shadow");
        // menu_item_id
        const menuItemId = $(this).data('menuItem')
        // menu_item name
        const menuItemName = $(this)[0].children[1].firstElementChild.innerText
        // console.log(priceNum)// line item price
        const price = $(this)[0].children[1].lastElementChild.lastElementChild.innerText
        const priceNum = parseFloat(price.match(/(\d+.?\d+)/)[0])
        $('#line-item-input').append(
          `<div class="row my-3">
            <div class="col-5 p-0">
              <!-- here goes the  menu item name-->
              <p class="text-white" >${menuItemName}</p>
              <input type="hidden" name="menu_item_id[]" value="${menuItemId}">
            </div>
            <div class="col-4 pl-0">
              <!-- here goes the toggler-->
              <div>
                <input type="number" name="quantity[]" style="width: 50%; border-radius: 30px;" class="text-center quantity" value="1">
              </div>

            </div>
            <div class="col-3 px-0 text-left">
              <!-- here goes the total price -->
              <div class="d-flex justify-content-around align-items-start">
                <span><p class="text-white value">${priceNum}</p></span>
                <span><a class="remove_field" ><i class="far fa-trash-alt" style="color: #ec524b;"></i></a></span>
              </div>
            </div>
          </div>
          `
        )

        let inputs = document.querySelectorAll('.quantity')
        const lastItem = inputs[inputs.length - 1]

        function calc(){
          let values = document.querySelectorAll('.value');
          let valuesArray = [];
          values.forEach(value => {
            valuesArray.push(parseFloat(value.innerText))
          });
          let totalPrice = valuesArray.reduce((a, b) => a + b, 0)
          total.innerText = totalPrice.toFixed(2);
        };

        calc();

        inputs.forEach(input =>{
          const price_per_one = input.parentElement.parentElement.nextElementSibling.lastElementChild.firstElementChild.lastElementChild.innerText
          input.addEventListener('input', (event) =>{
            const newQuantity = event.target.value
            const newPrice = event.path[3].lastElementChild.lastElementChild.firstElementChild
            let newValue = newQuantity * parseFloat(price_per_one)
            newPrice.innerHTML = `<span><p class="text-white value">${newValue}</p></span>`
            calc()
          })
        });

        $('#line-item-input').on("click",".remove_field", function(e){ //user click on remove text
          $(this).parents(':eq(3)').remove();
          calc()
        })


      });

    })


  });


</script>
