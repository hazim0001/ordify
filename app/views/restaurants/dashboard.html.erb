<div class="container-fluid">
  <div class="row">
    <%= render 'shared/side_bar' %>

    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4" style="margin-left: 13em !important;">

      <h2 class="mt-5"><%= current_employee.restaurant.name.capitalize %></h2>
      <hr>
      <%= form_for :@restaurant, url: dashboard_restaurant_path(@restaurant), method: :get do |f| %>
        <div class="search-form-control form-group">
          <label for="search_query"> Start Date</label>
          <input class="" type="datetime-local" name="query_start" value="<%= params[:query_start] %>" id="search_query" />
          <label for="search_quer_1"> End Date</label>
          <input class="" type="datetime-local" name="query_end" value="<%= params[:query_end] %>" id="search_query_1" />
          <input type="submit" class="btn btn-primary">
        </div>
      <% end %>



      <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
          <a class="nav-item nav-link active" id="revenue-tab" data-toggle="tab" href="#revenue" role="tab" aria-controls="revenue" aria-selected="true">Revenues data</a>
          <a class="nav-item nav-link" id="sales-by-day-tab" data-toggle="tab" href="#sales-by-day" role="tab" aria-controls="sales-by-day" aria-selected="false">Sales by day</a>
          <a class="nav-item nav-link" id="sales-by-hour-tab" data-toggle="tab" href="#sales-by-hour" role="tab" aria-controls="sales-by-hour" aria-selected="false">Sales by hour</a>
          <a class="nav-item nav-link" id="menuitem-sales-tab" data-toggle="tab" href="#menuitem-sales" role="tab" aria-controls="menuitem-sales" aria-selected="false">MenuItems sales distribution</a>

        </div>
      </nav>




      <div class="tab-content" id="nav-tabContent">

        <div class="tab-pane fade " id="sales-by-day" role="tabpanel" aria-labelledby="sales-by-day-tab">
          <div class="my-5">
            <p><ins>Sales by day</ins></p>
            <%= line_chart @mano.group_by_day(:order_created_at, series: false).count, download: true %>
          </div>
        </div>

        <div class="tab-pane fade" id="sales-by-hour" role="tabpanel" aria-labelledby="sales-by-hour-tab">
          <div class="my-5">
            <p><ins>Sales by hour</ins></p>
            <%= line_chart @restaurant.line_items.group_by_hour(:line_item_created_at, series: false).count, download: true, crosshair: true %>
          </div>
        </div>

        <div class="tab-pane fade" id="menuitem-sales" role="tabpanel" aria-labelledby="menuitem-sales-tab">
          <div class="my-5">
            <p><ins>MenuItems sales distribution</ins></p>
            <%= pie_chart LineItem.joins(:menu_item).group(:title).size, download: true %>
          </div>
        </div>

        <div class="tab-pane fade show active" id="revenue" role="tabpanel" aria-labelledby="revenue-tab">
          <% if @restaurant.orders.any? %>

            <h6 class="my-5">
              Last week's orders total (<%= @restaurant.orders.last_week.first.order_created_at.to_date %>)
              <span class="badge bg-success" style="font-size:0.9rem; color:white;font-weight: inherit;"><%= humanized_money_with_symbol(@restaurant.orders.last_week.sum(:total_price_cents) / 100) %> </span>
            </h6>
            <h6 class="my-5">
              Yesterday's orders total (<%= @restaurant.orders.yesterday.first.order_created_at.to_date %>)
              <span class="badge bg-success" style="font-size:0.9rem; color:white;font-weight: inherit;"><%= humanized_money_with_symbol(@restaurant.orders.yesterday.sum(:total_price_cents) / 100) %> </span>
            </h6>
            <h6 class="my-5">
              Orders total query (<%= @mano.first.order_created_at.to_date %>  - <%= @mano.last.order_created_at.to_date %>)
              <span class="badge bg-success" style="font-size:0.9rem; color:white;font-weight: inherit;"><%= humanized_money_with_symbol(@mano.sum(:total_price_cents) / 100) %> </span>
            </h6>

          <% end %>
        </div>

      </div>

    </main>
  </div>
</div>



